<!-- 
このドキュメントは skills-refactor-skill-to-single-workflow の日本語版です。
英語版: ../SKILL.md
-->

---
name: skills-refactor-skill-to-single-workflow
description: Convert a legacy multi-pattern skill into a single-workflow skill. Use when migrating existing skills.
author: RyoMurakami1983
tags: [copilot, agent-skills, refactoring, migration]
invocable: false
---

# スキルを単一ワークフローにリファクタリングする

レガシーのマルチパターンSKILL.md（7〜10個の`## Pattern N:`セクション）を「1スキル＝1ワークフロー」原則に従った単一ワークフロースキルに変換するエンドツーエンドのワークフロー。

## When to Use This Skill

このスキルを使用する場面：
- 既存のマルチパターンスキルを単一ワークフロー標準に変換する時
- リポジトリ全体のモダナイゼーション作業でレガシースキルを移行する時
- どのパターンを統合し、どれを別スキルに分割するか判断する時
- 新しく分割されたワークフロースキルを指すルータースキルを作成する時

---

## Core Principles

1. **セクションではなくワークフローで分割** — パターンが独立して実行可能なワークフローの場合のみ新スキルを作成（基礎と型）
2. **まず統合** — 多数の小スキルに分割するより、関連パターンを1つのワークフローにまとめることを優先（ニュートラル）
3. **コンテキストを保持** — 各結果スキルは自己完結的でなければならない; 分割しすぎてコンテキストが失われることを避ける（成長の複利）
4. **互換性のためのルーター** — 参照切れを防ぐため、元のディレクトリをルータースキルとして維持（継続は力）

---

## ワークフロー：単一ワークフローへのリファクタリング

### ステップ1 — 既存スキルの監査

パターンを数え、それぞれを分類する：

**分類ルール**：
- **トピック/セクション**: 概念について教えている → 1つのスキルに**統合**
- **独立ワークフロー**: 単独で最初から最後まで実行できる → 新スキルに**分割**
- **バリアント**: 異なる入力での同じワークフロー → 1つのスキル内のオプションとして保持

**Why**: この分類が最も重要なステップです。「独立して実行可能かどうか」が判断基準。これが基礎と型 — 最小形式で最大可能性を生む設計思想の実践です。

### ステップ2 — ワークフローにグループ化

**分割の判断基準**：
- ✅ 分割する: ワークフローが独自のトリガー（"Use when..."）を持ち、独立実行可能
- ❌ 分割しない: パターンが大きなワークフローのコンテキスト内でのみ意味がある

**Why**: 過度な分割はコンテキストの喪失を招きます。ニュートラルな視点 — 誰もが使える普遍性を保つために、自己完結性を重視します。

### ステップ3 — 新スキルを作成

`skills-author-skill`に従い、各ワークフローの新スキルディレクトリを作成。

### ステップ4 — 元スキルをルーターに変換

元のSKILL.mdを単一ワークフローのルータースキルとして書き換え。

**Why**: 継続は力 — 既存の参照を壊さないことで、段階的な移行を可能にします。

### ステップ5 — オーバーフローコンテンツの移動

元スキルの参照資料を適切な新スキルに移動。

### ステップ6 — クロスリファレンスの更新

リポジトリ全体で旧スキル名への参照を検索・更新。

### ステップ7 — 全結果を検証

各新スキルとルーターに対して`skills-validate-skill`を実行。

---

## Good Practices

### 1. 分割前にまず統合

**What**: すべてのパターンを1つのワークフローにまとめることから始め、結果が500行を超えるか本当に独立したワークフローを含む場合のみ分割。

**Why**: 過度な分割はコンテキスト喪失とメンテナンス負担の増加を招く。

**Values**: 基礎と型（最小形式で最大可能性）

### 2. ルータースキルは最小限に

**What**: ルーターSKILL.mdは100行未満 — フロントマター、"When to Use"、デシジョンテーブルのみ。

**Why**: ルーターは後方互換性のために存在し、コンテンツリポジトリではない。

**Values**: 継続は力

### 3. 著者とValuesを保持

**What**: すべての新スキルに`author: RyoMurakami1983`と憲法Values統合を保持。

**Values**: 成長の複利

---

## Common Pitfalls

### 1. すべてのパターンを個別スキルに分割

**Problem**: 8つのパターンから8つのマイクロスキルを作成し、各々が単独では小さすぎて役に立たない。

**Solution**: パターンが独自の"When to Use"を持つ独立実行可能なワークフローの場合のみ分割。

### 2. 分割でコンテキストを失う

**Problem**: 分割後、各新スキルが他のスキルで説明された概念を参照している。

**Solution**: 各スキルは自己完結的であるべき。広範なクロスリファレンスよりも必要なコンテキストを複製。

### 3. ルーターを忘れる

**Problem**: 元のディレクトリを削除し、すべての既存参照を壊す。

**Solution**: 常に元をルータースキルに変換; 移行中は削除しない。

---

## Quick Reference

### リファクタリングチェックリスト

- [ ] 監査: パターンを数え、各々を分類
- [ ] グループ化: パターンをエンドツーエンドワークフローにマッピング
- [ ] 作成: `skills-author-skill`に従い新スキルを作成
- [ ] ルーター: 元をルータースキルに変換
- [ ] 移動: references/assetsを新スキルディレクトリに再配置
- [ ] 更新: リポジトリ全体のクロスリファレンスを修正
- [ ] 検証: 全結果に`skills-validate-skill`を実行

---

## Changelog

### Version 1.0.0 (2026-02-13)
- 初版リリース：レガシーマルチパターンスキルの移行ワークフロー
- 監査→グループ化→作成→ルーター→検証パイプラインを含む
