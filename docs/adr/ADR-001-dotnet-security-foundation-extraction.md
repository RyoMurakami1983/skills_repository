# ADR-001: .NET WPF セキュリティ基盤の独立スキル抽出

## ステータス

Accepted

## 日付

2026-02-15

## コンテキスト

dotnet-wpf-secure-config の分離設計において、Dify API統合スキル（`dotnet-wpf-dify-api-integration`）と Oracle DB統合スキル（`dotnet-oracle-wpf-integration`）の両方で DPAPI 暗号化による設定管理が必要であった。

この共通コンポーネント（DPAPI暗号化・復号、設定ファイル管理、認証情報の安全な保存）をどのように扱うかを決定する必要があった。

## 決定

**Design A 採用** — セキュリティ基盤を独立スキル（`dotnet-wpf-secure-config`）として分離する。

DPAPI暗号化による設定・認証情報管理を、単一の独立スキルとして抽出し、他のスキルから参照・依存する形式とする。

## 検討した選択肢

### Design A（採用）: セキュリティ基盤を独立スキルに分離

- **概要**: DPAPI暗号化・設定管理を `dotnet-wpf-secure-config` として独立スキル化
- **メリット**:
  - DRY原則の遵守 — 同一ロジックの重複を排除
  - 再利用性 — 新しいスキルからも参照可能
  - 一元管理 — セキュリティ関連の変更を1箇所で管理
  - 学習コスト低減 — セキュリティパターンを1つのスキルで習得
- **デメリット**:
  - スキル間依存が発生する

### Design B（不採用）: Dify/Oracle 各スキルに埋め込み

- **概要**: 各スキル内にDPAPI暗号化ロジックをそれぞれ記述
- **メリット**:
  - スキル間の依存がない — 各スキルが自己完結
- **デメリット**:
  - コードの重複が発生 — DRY原則に違反
  - 保守コスト増 — セキュリティ修正を複数箇所に適用が必要
  - 不整合リスク — 各スキルのセキュリティ実装にばらつきが発生

## 結果

### Positive

- **DRY原則遵守**: セキュリティ基盤ロジックの重複を完全に排除
- **共通コンポーネント一元管理**: DPAPI暗号化の実装パターンを1箇所で維持
- **学習コスト低減**: セキュリティパターンの学習が`dotnet-wpf-secure-config`に集約
- **拡張性**: 将来の新スキル（例: Azure連携等）でも同じセキュリティ基盤を再利用可能

### Negative

- **スキル間依存の発生**: `dotnet-wpf-dify-api-integration` と `dotnet-oracle-wpf-integration` が `dotnet-wpf-secure-config` に依存
- **依存管理の複雑さ**: スキル更新時に依存先への影響確認が必要

## 決定基準

- **DRY原則**: 同一機能の重複を避ける
- **Values整合性**:
  - **基礎と型の追求**: セキュリティ基盤を「型」として確立し、応用の源泉とする
  - **成長の複利**: 一度作った基盤が複数のスキルで価値を生み、複利的に効果を拡大
- **保守性**: 変更箇所を最小化し、不整合リスクを低減

## 今後の類似判断チェックリスト

類似の設計判断を行う際は、以下の基準で評価する：

- [ ] 2つ以上のスキルで同一機能が必要か？
- [ ] 独立スキルとして再利用価値があるか？
- [ ] DRY原則に違反していないか？
- [ ] Values（基礎と型、成長の複利）と整合するか？

上記すべてに「はい」の場合、独立スキルへの分離を推奨する。
