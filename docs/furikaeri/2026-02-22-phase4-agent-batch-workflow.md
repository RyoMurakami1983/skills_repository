# ふりかえり（YWT）— 2026-02-22 Phase 4 + agent-batch-workflow セッション

## Session Story

1. Phase 4: WPFスキル10個をコスモス化（フロントマター統一、JA追加、overflow分離）
2. `git switch -c` ファーストを実践（mainへの直接コミットゼロ）
3. 3並列agent（作業2 + レビュー1）でバッチ処理
4. 5分間隔の報連相プロトコルを適用
5. ふりかえりの3 Tryを `agent-batch-workflow` スキルとして形式知化
6. PR #54（WPFモダン化）, PR #55（agent-batch-workflow + WPFモダン化統合）作成・レビュー対応

## YWT

### Y（やったこと）

- WPFスキル10個のフロントマターをnested metadata形式に統一
- 全10スキルに `references/SKILL.ja.md` を追加
- 500行超スキル7つを `references/detailed-patterns.md` にオーバーフロー分離
- `git switch -c feature/wpf-cosmos-modernization` でブランチファースト実践
- 3並列agent（作業2 + レビュー1）でB1(3) + B2-1(4) + B2-2(3) のバッチ処理
- 5分間隔の報連相プロトコルで進捗可視化
- ふりかえり3 Tryを `skills/agent-batch-workflow/` スキルとして形式知化（88.1% PASS）
- PR #55 レビュー対応: version削除10件、リンク修正1件、C#シグネチャ概要化4件

### W（わかったこと）

#### 並列agentについて

| 観点 | わかったこと |
|------|------------|
| **速度** | 10スキルを3バッチで処理。逐次なら10ターンのところ3ターン |
| **品質の均一性** | 2 workerが同じ間違いを並列に犯す（version残留が5スキル×2=10件） |
| **ローカルreview agent** | コミット前に実行したが**「問題なし」と報告**。version残留を見逃した |
| **GitHub PR reviewer** | PR作成後に16件の指摘。系統的エラー（version 10件）を検出したのはこちら |
| **ユーザー視点** | 作業中はブラックボックス。完了後の結果だけ見える |
| **最適構成** | 2 worker + 1 reviewer が実用的上限 |

→ **ローカルcode-review agentは期待ほど機能しなかった**。
系統的エラーの検出を担ったのは**GitHub PRレビュー**（copilot-pull-request-reviewer）。
ローカルagentのプロンプトに「フロントマター仕様チェック」を明示する必要がある。
テンプレートの問題は並列で増幅されるが、**最終的にGitHub PRレビューで可視化された**。

#### 報連相について

| 種類 | 実感 |
|------|------|
| **報告** | 5分ごとの ✅/🔄/⏳ フォーマットが有効。「介入不要」と安心できる |
| **連絡** | 予期しない発見を止めずに通知。事後対応で十分な場面が多い |
| **相談** | スコープ変更の判断はユーザーに委ねるべき。ここだけ「止める」のが正しい |

→ **報連相の価値は「安心感のデザイン」**。作業が見えなくても、定期報告があれば信頼できる。

#### branch-firstについて

- Phase 1-3 の失敗（mainに25コミット→force push）が完全に解消
- `git switch -c` を文字通り最初のコマンドにする規律は単純で効果的

#### 発見した課題

- workerへのプロンプトに「version削除」を含めていなかったため、全workerが同じミスを再現
- → **系統的エラーはプロンプト（入力）の問題であり、並列度の問題ではない**

### T（つぎにやること）

- workerプロンプトに「フロントマター非標準キーチェック」を明示的に含める
- **ローカルcode-review agentのプロンプトにもフロントマター仕様チェックを追加**（今回見逃した）
- GitHub PRレビューを最終防衛線として位置づけ、ローカルreviewとの二段構えにする
- skills/ 配下の残存 version キーも将来的に一括削除（git-initial-setup, github-pr-workflow 等）
- 報連相の定期報告フォーマットを agent-batch-workflow スキルに反映済み → 次回セッションで検証
- 並列agentの効果を可視化する方法を検討（所要時間の比較データ等）

### Priority (top 3)

1. 🔴 workerプロンプトの品質向上（系統的エラー防止）
2. 🟡 報連相フォーマットの実地検証（次回バッチ作業で）
3. 🟢 skills/ version キー一括削除（技術的負債解消）

### Action (SMART)

- **S**: agent-batch-workflow スキルのworkerプロンプトテンプレートに「非標準フロントマターキー排除」チェックを追加
- **M**: 次回バッチ作業でversion残留ゼロ
- **A**: プロンプトテンプレートの1行追加
- **R**: 今回の10件version残留の直接対策
- **T**: 次回バッチ作業セッションで適用

## Meta-Furikaeri

- YWTは「わかったこと」に焦点を当てやすく、分析目的に合っていた
- 次回: バッチ作業ならYWT、問題解決ならKPT、と使い分ける
- ふりかえり形式の選択基準:
  - KPT: 問題が多い・改善したい場面
  - YWT: 学びが多い・何が分かったか整理したい場面
